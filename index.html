<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TSE 2026 - Brookasil RP</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Syncopate:wght@700&family=Plus+Jakarta+Sans:wght@300;400;600;800&display=swap" rel="stylesheet">
    <style>
        :root { --primary: #009E49; --secondary: #3A75C4; --accent: #FCD116; --bg: #020617; }
        body { font-family: 'Plus Jakarta Sans', sans-serif; background-color: var(--bg); color: #f8fafc; min-height: 100vh; overflow-x: hidden; }
        
        /* Fundo Animado com Cores do Gabão */
        .bg-glow { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: -1; background: radial-gradient(at 0% 0%, rgba(0, 158, 73, 0.15) 0px, transparent 50%), radial-gradient(at 100% 100%, rgba(58, 117, 196, 0.15) 0px, transparent 50%), radial-gradient(at 50% 50%, rgba(252, 209, 22, 0.05) 0px, transparent 50%); }
        
        .font-title { font-family: 'Syncopate', sans-serif; }
        .glass { background: rgba(255, 255, 255, 0.03); backdrop-filter: blur(20px); border: 1px solid rgba(255, 255, 255, 0.1); border-radius: 40px; box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5); }
        
        /* Bandeira Animada */
        .flag-container { display: flex; gap: 4px; height: 30px; }
        .flag-bar { width: 10px; height: 100%; animation: wave 1.5s infinite ease-in-out; }
        .bar-green { background: #009E49; animation-delay: 0.1s; }
        .bar-yellow { background: #FCD116; animation-delay: 0.2s; }
        .bar-blue { background: #3A75C4; animation-delay: 0.3s; }
        @keyframes wave { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-8px); } }

        .input-field { background: rgba(0, 0, 0, 0.4); border: 2px solid rgba(255, 255, 255, 0.05); padding: 18px; border-radius: 18px; width: 100%; color: white; transition: 0.4s; }
        .input-field:focus { border-color: var(--accent); box-shadow: 0 0 20px rgba(252, 209, 22, 0.2); outline: none; background: rgba(0,0,0,0.6); }
        
        .section { display: none; }
        .section.active { display: block; animation: fadeIn 0.6s ease; }
        @keyframes fadeIn { from { opacity: 0; filter: blur(10px); } to { opacity: 1; filter: blur(0); } }

        .btn-nav { padding: 14px 28px; font-weight: 800; font-size: 0.7rem; border-radius: 15px; transition: 0.4s; opacity: 0.4; letter-spacing: 2px; }
        .btn-nav.selected { opacity: 1; background: white; color: black; box-shadow: 0 0 30px rgba(255,255,255,0.2); }

        /* Card Visual */
        .card-candidato { border-left: 6px solid transparent; transition: 0.3s; }
        .card-Direita { border-left-color: #3b82f6; }
        .card-Centro { border-left-color: #10b981; }
        .card-Esquerda { border-left-color: #ef4444; }
    </style>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getDatabase, ref, push, onValue, update, set, get } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

        const firebaseConfig = { databaseURL: "https://candidatura-cde-default-rtdb.firebaseio.com" };
        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);

       const partidosMap = {
  Direita: [
    "PL (22) - Partido Liberal", "PP (11) - Progressistas", "Republicanos (10)", 
    "PRTN (75) - Partido Republicano Trabalhista Nacional", "Patriota (51)", 
    "PRTB (28) - Partido Renovador Trabalhista Brasileiro", "NOVO (30)", 
    "PMB (35) - Partido da Mulher Brasileira", "DC (27) - Democracia Cristã", 
    "UDB (38) - União da Direita Brookasileira", "Agir (36)", 
    "POL (81) - Partido da Ordem e Liberdade", "ACN (84) - Aliança Cristã Nacional", 
    "PRONA (57) - Partido da Reedificação da Ordem Nacional", "FIB (90) - Frente Integralista Brasileira", 
    "PDC (17) - Partido Democrata Cristão", "PESP (48) - Partido da Esperança", 
    "PMNL (86) - Partido Militar Nacionalista"
  ],
  Centro: [
    "MDB (15) - Movimento Democrático Brasileiro", "UNIÃO (44) - União Brasil", 
    "PSD (55) - Partido Social Democrático", "Podemos (20)", 
    "PSDB (45) - Partido da Social Democracia Brasileira", "Cidadania (CDN)", 
    "Solidariedade (77)", "Avante (70)", "PMN (33) - Partido da Mobilização Nacional", 
    "Pros (90)", "PV (43) - Partido Verde", "PUN (42) - Partido da União Nacional", 
    "MPD (37) - Movimento Popular Democrático", "PDM (26) - Partido da Mudança", 
    "MTB (63) - Movimento Trabalhista Brookasileiro", "PTD (46) - Partido Trabalhista Democrático", 
    "PDSD (88) - Partido do Sindicato Democrata", "MSS (14) - Partido Missão"
  ],
  Esquerda: [
    "PT (13) - Partido dos Trabalhadores", "PSOL (50) - Partido Socialismo e Liberdade", 
    "PCdoB (65) - Partido Comunista do Brasil", "Rede (18) - Rede Sustentabilidade", 
    "PDT (12) - Partido Democrático Trabalhista", "UP (80) - Unidade Popular", 
    "PCO (29) - Partido da Causa Operária", "PCB (21) - Partido Comunista Brasileiro", 
    "PSTU (16) - Partido Socialista dos Trabalhadores Unificado", "PPL (54) - Partido Pátria Livre", 
    "PSB (40) - Partido Socialista Brasileiro", "PFS (60) - Partido da Frente Socialista", 
    "PS (56) - Partido Socialista", "PSTN (31) - Partido Social Trabalhista Nacional"
  ]
};
        };
        const senhasTSE = { "Brookhaven": "Brookasil1234", "Novacore": "williamNC", "Casteríber": "henriqueCB", "Fortemega": "lucasFM", "Florêmix": "charlesFX" };
        let eleicaoTipo = "Federal", admEstado = null;

        onValue(ref(db, 'config/tipoEleicao'), (s) => { 
            eleicaoTipo = s.val() || "Federal"; 
            document.querySelectorAll('.txt-eleicao').forEach(e => e.innerText = eleicaoTipo);
            atualizarCargos();
        });

        window.showTab = (id) => {
            if(id === 'aba-adm' && !admEstado) { document.getElementById('modalLogin').classList.remove('hidden'); return; }
            document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
            document.getElementById(id).classList.add('active');
            document.querySelectorAll('.btn-nav').forEach(b => {
                b.classList.remove('selected');
                if(b.getAttribute('onclick').includes(id)) b.classList.add('selected');
            });
            if(id === 'aba-candidatos') carregarCandidatos();
            if(id === 'aba-adm') carregarListaAdm();
        };

        window.loginTSE = () => {
            const e = document.getElementById('admEstadoLogin').value, p = document.getElementById('admPassLogin').value;
            if(senhasTSE[e] === p) {
                admEstado = e; document.getElementById('modalLogin').classList.add('hidden');
                document.getElementById('admInfo').innerText = `TSE: ${e}`;
                document.getElementById('painelTrocaEleicao').classList.toggle('hidden', e !== "Brookhaven");
                showTab('aba-adm');
            } else alert("ACESSO NEGADO.");
        };

        window.mudarLado = (l) => {
            const s = document.getElementById('partido');
            s.innerHTML = '<option value="">Selecione o Partido</option>';
            if(l && partidosMap[l]) partidosMap[l].forEach(p => s.innerHTML += `<option value="${p}">${p}</option>`);
            atualizarNumeroBase();
        };

        window.atualizarCargos = () => {
            const s = document.getElementById('cargo'), l = eleicaoTipo === "Federal" ? ['Presidente', 'Governador', 'Senador', 'Deputado Federal', 'Deputado Estadual'] : ['Prefeito', 'Vereador'];
            s.innerHTML = l.map(c => `<option value="${c}">${c}</option>`).join('');
            document.getElementById('filtrosCargos').innerHTML = `<button onclick="carregarCandidatos('todos')" class="bg-white/5 border border-white/10 px-4 py-2 rounded-xl text-[10px] font-bold">TODOS</button>` + 
                l.map(c => `<button onclick="carregarCandidatos('${c}')" class="bg-white/5 border border-white/10 px-4 py-2 rounded-xl text-[10px] font-bold">${c.toUpperCase()}</button>`).join('');
            atualizarNumeroBase();
        };

        window.atualizarNumeroBase = () => {
            const p = document.getElementById('partido').value, c = document.getElementById('cargo').value, nf = document.getElementById('numFixo'), ne = document.getElementById('numExtra'), de = document.getElementById('divExtra');
            if(p) {
                const m = p.match(/\((\d+)\)/); nf.value = m ? m[1] : ""; de.classList.remove('hidden'); ne.value = "";
                const t = { "Senador": 1, "Deputado Federal": 2, "Deputado Estadual": 3, "Vereador": 3 };
                ne.maxLength = t[c] || 0; if(!t[c]) de.classList.add('hidden');
            } else de.classList.add('hidden');
        };

        document.getElementById('formCandidatura').onsubmit = async (e) => {
            e.preventDefault();
            const n = document.getElementById('nome').value.trim();
            const est = document.getElementById('estadoInsc').value;
            const numF = document.getElementById('numFixo').value + document.getElementById('numExtra').value;
            
            if(n.split(' ').length < 2) return alert("Digite Nome e Sobrenome.");

            // CORREÇÃO: Verifica duplicidade APENAS no mesmo estado e mesma eleição
            const snap = await get(ref(db, 'candidatos'));
            let dup = false;
            snap.forEach(doc => {
                const c = doc.val();
                if(c.numero === numF && c.estado === est && c.tipoEleicao === eleicaoTipo && c.status !== 'recusado') {
                    dup = true;
                }
            });

            if(dup) return alert(`O número ${numF} já está registrado em ${est} para esta eleição!`);

            await push(ref(db, 'candidatos'), {
                nome: n, cpf: document.getElementById('cpf').value, lado: document.getElementById('lado').value,
                partido: document.getElementById('partido').value, cargo: document.getElementById('cargo').value,
                estado: est, tiktok: document.getElementById('tiktok').value, numero: numF, status: "pendente", tipoEleicao: eleicaoTipo
            });
            alert("SUCESSO! Aguarde aprovação do TSE estadual."); e.target.reset();
        };

        window.carregarCandidatos = (filtro = 'todos') => {
            onValue(ref(db, 'candidatos'), (s) => {
                const g = document.getElementById('gridCandidatos'); g.innerHTML = "";
                s.forEach(ch => {
                    const c = ch.val();
                    if(c.status === "aceito" && c.tipoEleicao === eleicaoTipo && (filtro === 'todos' || c.cargo === filtro)) {
                        g.innerHTML += `
                            <div class="glass p-8 card-candidato card-${c.lado} relative overflow-hidden group">
                                <div class="absolute -right-2 -top-2 opacity-5 font-title text-7xl">${c.estado[0]}</div>
                                <p class="text-[10px] font-black text-white/30 uppercase tracking-widest">${c.partido}</p>
                                <h3 class="text-2xl font-black text-white mt-1 mb-4 uppercase leading-none">${c.nome}</h3>
                                <div class="text-6xl font-title text-white mb-6 tracking-tighter group-hover:text-accent transition-colors">${c.numero}</div>
                                <div class="flex justify-between items-center text-[10px] font-bold">
                                    <span class="bg-white/10 px-3 py-1 rounded-lg">${c.cargo}</span>
                                    <span class="text-emerald-400 font-black">${c.estado}</span>
                                </div>
                            </div>`;
                    }
                });
            });
        };

        function carregarListaAdm() {
            onValue(ref(db, 'candidatos'), (s) => {
                const l = document.getElementById('listaAdm'); l.innerHTML = "";
                s.forEach(ch => {
                    const c = ch.val();
                    if(admEstado === "Brookhaven" || c.estado === admEstado) {
                        l.innerHTML += `
                            <div class="glass p-6 flex flex-col md:flex-row justify-between items-center mb-4 border-l-4 ${c.status === 'pendente' ? 'border-accent' : 'border-emerald-500'}">
                                <div>
                                    <p class="font-black text-xl">${c.nome} <span class="text-accent">#${c.numero}</span></p>
                                    <p class="text-[10px] opacity-50 font-bold uppercase">${c.cargo} | ${c.estado} | TT: ${c.tiktok}</p>
                                </div>
                                <div class="flex gap-3 w-full md:w-auto mt-4 md:mt-0">
                                    <button onclick="setStatus('${ch.key}', 'aceito')" class="flex-1 bg-emerald-600 px-6 py-3 rounded-xl font-black text-[10px]">APROVAR</button>
                                    <button onclick="setStatus('${ch.key}', 'recusado')" class="flex-1 bg-red-600 px-6 py-3 rounded-xl font-black text-[10px]">RECUSAR</button>
                                </div>
                            </div>`;
                    }
                });
            });
        }
        window.setStatus = (id, s) => update(ref(db, `candidatos/${id}`), { status: s });
        window.setEleicao = (t) => { if(admEstado === "Brookhaven") { set(ref(db, 'config/tipoEleicao'), t); alert("Eleição Alterada!"); } };
    </script>
</head>
<body class="p-4 md:p-12">
    <div class="bg-glow"></div>

    <header class="max-w-7xl mx-auto flex flex-col md:flex-row justify-between items-center mb-24 gap-12">
        <div class="text-center md:text-left">
            <div class="flag-container mb-4 justify-center md:justify-start">
                <div class="flag-bar bar-green"></div><div class="flag-bar bar-yellow"></div><div class="flag-bar bar-blue"></div>
                <span class="ml-4 text-[10px] font-black tracking-[0.5em] opacity-50 uppercase">Sistema Governamental</span>
            </div>
            <h1 class="text-6xl md:text-7xl font-title font-bold text-white tracking-tighter leading-none">TSE<span class="text-accent">.</span>2026</h1>
            <p class="text-emerald-400 font-bold text-[12px] tracking-[0.6em] uppercase mt-4">Justiça Eleitoral de Brookasil</p>
        </div>
        
        <nav class="glass p-3 flex gap-2">
            <button onclick="showTab('aba-candidatura')" class="btn-nav selected">REGISTRO</button>
            <button onclick="showTab('aba-candidatos')" class="btn-nav">CANDIDATOS</button>
            <button onclick="showTab('aba-adm')" class="btn-nav text-red-400">ADMINISTRAÇÃO</button>
        </nav>
    </header>

    <main class="max-w-7xl mx-auto">
        <section id="aba-candidatura" class="section active">
            <div class="max-w-5xl mx-auto glass p-10 md:p-20 relative">
                <div class="absolute top-10 right-10 flex gap-1 opacity-20">
                    <div class="w-8 h-8 bg-green-600 rounded-full"></div><div class="w-8 h-8 bg-yellow-400 rounded-full"></div><div class="w-8 h-8 bg-blue-600 rounded-full"></div>
                </div>
                <h2 class="text-4xl font-black mb-16 uppercase italic border-l-8 border-accent pl-8">Inscrição Eleitoral <span class="text-accent txt-eleicao block text-sm not-italic mt-2 font-bold tracking-widest">FEDERAL</span></h2>
                
                <form id="formCandidatura" class="grid md:grid-cols-2 gap-16">
                    <div class="space-y-10">
                        <label class="block"><span class="text-[10px] font-black uppercase opacity-40 ml-2 mb-2 block">Cidadão (Nome/Sobrenome)</span><input type="text" id="nome" class="input-field" placeholder="Ex: Gabriel Camargo" required></label>
                        <div class="grid grid-cols-2 gap-6">
                            <label class="block"><span class="text-[10px] font-black uppercase opacity-40 ml-2 mb-2 block">Espectro</span><select id="lado" onchange="mudarLado(this.value)" class="input-field" required><option value="">Selecione</option><option>Direita</option><option>Centro</option><option>Esquerda</option></select></label>
                            <label class="block"><span class="text-[10px] font-black uppercase opacity-40 ml-2 mb-2 block">Estado</span><select id="estadoInsc" class="input-field" required><option>Brookhaven</option><option>Novacore</option><option>Casteríber</option><option>Fortemega</option><option>Florêmix</option></select></label>
                        </div>
                        <label class="block"><span class="text-[10px] font-black uppercase opacity-40 ml-2 mb-2 block">Perfil TikTok</span><input type="text" id="tiktok" class="input-field" placeholder="@oficial_perfil" required></label>
                        <input type="hidden" id="cpf" value="GERADO-PELO-SISTEMA">
                    </div>

                    <div class="space-y-10">
                        <label class="block"><span class="text-[10px] font-black uppercase opacity-40 ml-2 mb-2 block">Cargo</span><select id="cargo" onchange="atualizarNumeroBase()" class="input-field" required></select></label>
                        <label class="block"><span class="text-[10px] font-black uppercase opacity-40 ml-2 mb-2 block">Partido</span><select id="partido" onchange="atualizarNumeroBase()" class="input-field" required><option value="">Selecione o Lado</option></select></label>
                        
                        <div class="p-10 bg-black/40 rounded-[30px] border border-white/10 text-center">
                            <span class="text-[10px] font-black text-accent block mb-4 uppercase tracking-[0.3em]">Número de Urna</span>
                            <div class="flex items-center justify-center gap-4">
                                <input type="text" id="numFixo" class="w-20 text-7xl font-title bg-transparent text-white outline-none text-center" readonly>
                                <div id="divExtra" class="hidden flex items-center gap-2">
                                    <span class="text-4xl opacity-20">+</span>
                                    <input type="text" id="numExtra" class="w-28 text-6xl font-title bg-white/5 border-b-4 border-accent text-accent outline-none px-2 rounded-lg" placeholder="00">
                                </div>
                            </div>
                        </div>
                        <button type="submit" class="w-full bg-accent p-8 rounded-[24px] font-black text-black text-xl hover:scale-[1.03] active:scale-95 transition-all shadow-[0_0_40px_rgba(252,209,22,0.3)]">CONFIRMAR REGISTRO</button>
                    </div>
                </form>
            </div>
        </section>

        <section id="aba-candidatos" class="section">
            <div class="flex flex-col md:flex-row justify-between items-end mb-20 gap-8">
                <div>
                    <h2 class="text-6xl font-black italic uppercase leading-none">Candidatos<br><span class="text-accent txt-eleicao">FEDERAL</span></h2>
                </div>
                <div id="filtrosCargos" class="flex flex-wrap gap-3"></div>
            </div>
            <div id="gridCandidatos" class="grid grid-cols-1 md:grid-cols-3 lg:grid-cols-4 gap-8"></div>
        </section>

        <section id="aba-adm" class="section">
            <div class="glass p-12 mb-12 flex flex-col md:flex-row justify-between items-center gap-8">
                <div><h2 id="admInfo" class="text-3xl font-black text-accent uppercase">TSE ADMIN</h2><p class="text-xs opacity-40 font-bold uppercase tracking-widest">Controle Governamental</p></div>
                <div id="painelTrocaEleicao" class="hidden flex gap-4">
                    <button onclick="setEleicao('Federal')" class="bg-blue-600 px-8 py-4 rounded-2xl font-black text-[10px]">ATIVAR FEDERAL</button>
                    <button onclick="setEleicao('Municipal')" class="bg-emerald-600 px-8 py-4 rounded-2xl font-black text-[10px]">ATIVAR MUNICIPAL</button>
                </div>
                <button onclick="location.reload()" class="bg-red-500/10 border border-red-500 text-red-500 px-8 py-4 rounded-2xl font-black text-[10px] hover:bg-red-500 hover:text-white transition">SAIR DO SISTEMA</button>
            </div>
            <div id="listaAdm" class="max-w-5xl mx-auto"></div>
        </section>
    </main>

    <div id="modalLogin" class="fixed inset-0 modal-adm z-[100] hidden flex items-center justify-center p-6">
        <div class="glass p-16 rounded-[60px] w-full max-w-md border-accent/20 text-center">
            <h3 class="font-title text-2xl text-accent mb-12">AUTENTICAÇÃO</h3>
            <select id="admEstadoLogin" class="input-field mb-4"><option>Brookhaven</option><option>Novacore</option><option>Casteríber</option><option>Fortemega</option><option>Florêmix</option></select>
            <input type="password" id="admPassLogin" placeholder="Chave de Acesso" class="input-field mb-10 text-center font-bold tracking-widest">
            <button onclick="loginTSE()" class="w-full bg-accent p-6 rounded-2xl font-black text-black">ACESSAR PAINEL</button>
            <button onclick="document.getElementById('modalLogin').classList.add('hidden')" class="mt-6 text-[10px] font-bold opacity-30 uppercase">Voltar ao site</button>
        </div>
    </div>
</body>
</html>
