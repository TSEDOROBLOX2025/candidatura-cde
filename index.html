<!doctype html>
<html lang="pt-BR" class="dark">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>TSE — Sistema Eleitoral 2026</title>

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;700&family=Space+Grotesk:wght@300;500;700&display=swap" rel="stylesheet">

  <script src="https://cdn.tailwindcss.com"></script>
  
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <script>
    tailwind.config = {
      darkMode: 'class',
      theme: {
        extend: {
          fontFamily: {
            sans: ['Outfit', 'sans-serif'],
            mono: ['Space Grotesk', 'monospace'],
          },
          colors: {
            dark: {
              900: '#05050A', // Ultra dark background
              800: '#0F111A', // Secondary dark
              glass: 'rgba(15, 17, 26, 0.65)',
            },
            brand: {
              gold: '#FFD700',
              glow: 'rgba(255, 215, 0, 0.5)'
            }
          },
          animation: {
            'float': 'float 6s ease-in-out infinite',
            'slide-up': 'slideUp 0.6s cubic-bezier(0.16, 1, 0.3, 1)',
            'pulse-slow': 'pulse 4s cubic-bezier(0.4, 0, 0.6, 1) infinite',
          },
          keyframes: {
            float: {
              '0%, 100%': { transform: 'translateY(0)' },
              '50%': { transform: 'translateY(-10px)' },
            },
            slideUp: {
              '0%': { transform: 'translateY(30px)', opacity: '0' },
              '100%': { transform: 'translateY(0)', opacity: '1' },
            }
          }
        }
      }
    }
  </script>

  <style>
    /* Estilos Globais e Efeitos de Vidro */
    body {
      background-color: #05050A;
      background-image: 
        radial-gradient(circle at 10% 20%, rgba(59, 130, 246, 0.08), transparent 40%),
        radial-gradient(circle at 90% 80%, rgba(245, 158, 11, 0.05), transparent 40%);
      color: #E2E8F0;
      overflow: hidden;
    }

    /* Scrollbar Futurista */
    ::-webkit-scrollbar { width: 4px; }
    ::-webkit-scrollbar-track { background: transparent; }
    ::-webkit-scrollbar-thumb { background: #334155; border-radius: 20px; }

    /* Glass Cards */
    .card-glass {
      background: var(--tw-colors-dark-glass);
      backdrop-filter: blur(16px);
      -webkit-backdrop-filter: blur(16px);
      border: 1px solid rgba(255, 255, 255, 0.08);
      border-radius: 24px;
      box-shadow: 0 4px 30px rgba(0, 0, 0, 0.3);
      transition: all 0.3s ease;
    }
    
    .card-glass:hover {
      border-color: rgba(255, 255, 255, 0.2);
      transform: translateY(-2px);
      box-shadow: 0 15px 40px -10px rgba(0,0,0,0.6);
    }

    /* Inputs High-Tech */
    .input-tech {
      background: rgba(0,0,0,0.3);
      border: 1px solid rgba(255,255,255,0.1);
      color: white;
      font-family: 'Space Grotesk', monospace;
      transition: all 0.3s;
    }
    .input-tech:focus {
      border-color: #3B82F6;
      box-shadow: 0 0 15px rgba(59, 130, 246, 0.2);
      outline: none;
      background: rgba(0,0,0,0.5);
    }

    /* Botão Dourado */
    .btn-gold {
      background: linear-gradient(135deg, #F59E0B 0%, #FFD700 100%);
      color: #000;
      font-weight: 700;
      letter-spacing: 1px;
      position: relative;
      overflow: hidden;
      border: none;
      transition: all 0.3s;
    }
    .btn-gold:hover {
      box-shadow: 0 0 25px rgba(255, 215, 0, 0.4);
      transform: scale(1.02);
    }

    /* Navegação Lateral */
    .nav-item { position: relative; overflow: hidden; }
    .nav-item.active {
      background: linear-gradient(90deg, rgba(59, 130, 246, 0.15), transparent);
      color: #60A5FA;
      border-left: 3px solid #60A5FA;
    }
    .nav-item:hover:not(.active) { color: white; background: rgba(255,255,255,0.03); }

    /* Loader */
    .loader {
      width: 18px; height: 18px;
      border: 2px solid #000;
      border-bottom-color: transparent;
      border-radius: 50%;
      display: inline-block;
      animation: rotation 1s linear infinite;
    }
    @keyframes rotation { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
  </style>
</head>
<body class="flex h-screen selection:bg-brand-gold selection:text-black font-sans">

  <div class="fixed top-0 left-0 w-full h-full pointer-events-none z-0 overflow-hidden">
    <div class="absolute top-[10%] left-[20%] w-[500px] h-[500px] bg-blue-600/10 rounded-full blur-[100px] animate-pulse-slow"></div>
    <div class="absolute bottom-[10%] right-[10%] w-[400px] h-[400px] bg-amber-500/5 rounded-full blur-[100px] animate-pulse-slow" style="animation-delay: 1s;"></div>
  </div>

  <aside class="w-20 lg:w-72 bg-dark-800/80 backdrop-blur-xl border-r border-white/5 flex flex-col justify-between flex-shrink-0 z-20">
    <div>
      <div class="h-24 flex items-center justify-center lg:justify-start lg:px-8 border-b border-white/5">
        <div class="w-10 h-10 rounded-xl bg-gradient-to-br from-blue-600 to-indigo-600 flex items-center justify-center shadow-lg shadow-blue-500/20">
          <i class="fa fa-scale-balanced text-white"></i>
        </div>
        <div class="hidden lg:block ml-4">
          <h1 class="text-2xl font-bold tracking-tight text-white font-mono">TSE <span class="text-blue-500">2026</span></h1>
          <p class="text-[10px] uppercase tracking-[0.2em] text-gray-500 font-bold">Oficial</p>
        </div>
      </div>

      <nav class="mt-10 space-y-2 px-3">
        <button onclick="switchTab('dashboard', this)" class="nav-item active w-full flex items-center gap-4 px-4 py-4 rounded-xl text-gray-400 transition-all group">
          <i class="fa fa-chart-pie text-xl w-6 text-center group-hover:scale-110 transition-transform"></i>
          <span class="hidden lg:block font-medium tracking-wide">Dashboard</span>
        </button>

        <button onclick="switchTab('candidatos', this)" class="nav-item w-full flex items-center gap-4 px-4 py-4 rounded-xl text-gray-400 transition-all group">
          <i class="fa fa-users-viewfinder text-xl w-6 text-center group-hover:scale-110 transition-transform"></i>
          <span class="hidden lg:block font-medium tracking-wide">Candidaturas</span>
        </button>

        <button onclick="switchTab('registro', this)" class="nav-item w-full flex items-center gap-4 px-4 py-4 rounded-xl text-gray-400 transition-all group">
          <i class="fa fa-file-signature text-xl w-6 text-center group-hover:scale-110 transition-transform"></i>
          <span class="hidden lg:block font-medium tracking-wide">Registrar</span>
        </button>
      </nav>
    </div>

    <div class="p-6 border-t border-white/5">
      <button onclick="switchTab('admin', this)" class="nav-item w-full flex items-center gap-4 px-4 py-3 rounded-xl text-amber-500/70 hover:text-amber-400 transition-all mb-4 border border-dashed border-amber-900/50 hover:border-amber-500/50">
        <i class="fa fa-gavel text-lg w-6 text-center"></i>
        <span class="hidden lg:block font-medium">Área Restrita</span>
      </button>
      
      <div class="hidden lg:block bg-black/40 rounded-xl p-4 border border-white/5 relative overflow-hidden group">
        <div class="absolute -right-4 -top-4 w-12 h-12 bg-blue-500 blur-xl opacity-20 group-hover:opacity-40 transition"></div>
        <p class="text-[10px] text-gray-500 uppercase font-bold mb-1 tracking-wider">Modo Eleitoral</p>
        <div class="flex items-center gap-2">
          <div class="w-1.5 h-1.5 rounded-full bg-green-500 animate-pulse"></div>
          <span id="displayMode" class="text-sm font-mono font-bold text-white tracking-widest">CARREGANDO...</span>
        </div>
      </div>
    </div>
  </aside>

  <main class="flex-1 flex flex-col relative h-screen overflow-hidden z-10">
    
    <header class="h-24 bg-dark-900/30 backdrop-blur-sm border-b border-white/5 flex items-center justify-between px-8 lg:px-12 z-10">
      <div class="flex flex-col animate-slide-up">
        <span class="text-xs text-blue-400 font-mono tracking-widest mb-1" id="serverDate">...</span>
        <h2 class="text-2xl font-bold text-white tracking-tight" id="pageTitle">Visão Geral</h2>
      </div>
      <div class="flex items-center gap-8">
        <div class="text-right hidden md:block">
          <div id="clock" class="text-3xl font-mono font-bold text-white leading-none tracking-wider">00:00</div>
          <span class="text-[9px] text-gray-500 font-bold uppercase tracking-[0.2em]">Horário Oficial de Brasília</span>
        </div>
        <div class="w-12 h-12 rounded-full bg-gradient-to-b from-gray-800 to-black border border-white/10 flex items-center justify-center text-gray-400 shadow-lg">
          <i class="fa fa-user-shield"></i>
        </div>
      </div>
    </header>

    <div class="flex-1 overflow-y-auto p-4 lg:p-10 relative scroll-smooth">
      
      <section id="dashboard" class="space-y-8 animate-slide-up max-w-7xl mx-auto">
        <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
          <div class="card-glass p-8 relative overflow-hidden group">
            <div class="absolute right-0 top-0 p-4 opacity-5 group-hover:opacity-10 transition-all duration-500 transform group-hover:scale-125">
              <i class="fa fa-globe text-8xl text-white"></i>
            </div>
            <p class="text-xs text-gray-400 font-bold uppercase tracking-widest mb-2">Total de Registros</p>
            <h3 id="statTotal" class="text-6xl font-mono font-bold text-white tracking-tighter">0</h3>
            <div class="mt-4 inline-flex items-center text-xs text-blue-400 font-mono">
              <span class="w-2 h-2 bg-blue-500 rounded-full mr-2 animate-pulse"></span> Sistema Online
            </div>
          </div>

          <div class="card-glass p-8 relative overflow-hidden group border-l-2 border-l-amber-500">
            <div class="absolute right-0 top-0 p-4 opacity-5 group-hover:opacity-10 transition-all">
              <i class="fa fa-scale-unbalanced text-8xl text-amber-500"></i>
            </div>
            <p class="text-xs text-gray-400 font-bold uppercase tracking-widest mb-2">Em Julgamento</p>
            <h3 id="statPending" class="text-6xl font-mono font-bold text-amber-500 tracking-tighter">0</h3>
            <div class="mt-4 text-xs text-gray-500 font-mono">Aguardando deferimento</div>
          </div>

          <div class="card-glass p-8 relative overflow-hidden group border-l-2 border-l-green-500">
            <div class="absolute right-0 top-0 p-4 opacity-5 group-hover:opacity-10 transition-all">
              <i class="fa fa-check-double text-8xl text-green-500"></i>
            </div>
            <p class="text-xs text-gray-400 font-bold uppercase tracking-widest mb-2">Candidatos Aptos</p>
            <h3 id="statApproved" class="text-6xl font-mono font-bold text-green-500 tracking-tighter">0</h3>
            <div class="mt-4 text-xs text-gray-500 font-mono">Homologados no sistema</div>
          </div>
        </div>

        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
          <div class="card-glass p-8 lg:col-span-2">
            <h3 class="text-xl font-bold text-white mb-8 flex items-center gap-3">
              <span class="w-1 h-6 bg-blue-500 rounded-full"></span>
              Distribuição por Cargo
            </h3>
            <div class="h-72 w-full">
              <canvas id="chartCargos"></canvas>
            </div>
          </div>
          <div class="card-glass p-8 flex flex-col">
            <h3 class="text-xl font-bold text-white mb-8 flex items-center gap-3">
              <span class="w-1 h-6 bg-purple-500 rounded-full"></span>
              Ideologia
            </h3>
            <div class="h-56 w-full relative flex-1">
              <canvas id="chartIdeologia"></canvas>
            </div>
          </div>
        </div>
      </section>

      <section id="candidatos" class="hidden animate-slide-up max-w-[1600px] mx-auto pb-20">
        <div class="flex flex-col md:flex-row justify-between items-end gap-6 mb-10 border-b border-white/5 pb-6">
          <div>
            <h2 class="text-4xl font-mono font-bold text-white tracking-tight">Candidaturas Oficiais</h2>
            <p class="text-gray-400 text-sm mt-2 max-w-xl">Relação pública de cidadãos com registro deferido pela justiça eleitoral vigente.</p>
          </div>
          <div class="bg-black/40 p-1.5 rounded-xl border border-white/10 flex backdrop-blur-md">
            <select id="filterPublicLado" class="bg-transparent text-white text-sm outline-none px-4 py-2 cursor-pointer font-mono min-w-[200px]">
              <option value="">Todas as Ideologias</option>
              <option value="Direita">Direita</option>
              <option value="Centro">Centro</option>
              <option value="Esquerda">Esquerda</option>
            </select>
          </div>
        </div>
        
        <div id="publicGrid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6">
          </div>
      </section>

      <section id="registro" class="hidden animate-slide-up max-w-4xl mx-auto pb-20">
        <div class="text-center mb-12">
          <div class="w-20 h-20 mx-auto bg-gradient-to-br from-amber-400/20 to-yellow-600/20 rounded-full flex items-center justify-center text-amber-500 text-3xl shadow-[0_0_30px_rgba(245,158,11,0.2)] mb-6 border border-amber-500/30">
            <i class="fa fa-signature"></i>
          </div>
          <h2 class="text-4xl font-mono font-bold text-white">Ficha de Candidatura</h2>
          <p class="text-gray-400 mt-3 font-mono text-sm uppercase tracking-wide">Preencha os dados com exatidão.</p>
        </div>

        <div class="card-glass p-8 md:p-12 relative overflow-hidden">
          <div class="absolute top-0 right-0 w-64 h-64 bg-blue-500/10 rounded-full blur-[80px] pointer-events-none"></div>

          <form id="formCandidato" class="space-y-8 relative z-10">
            <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
              <div class="space-y-2">
                <label class="text-[10px] font-bold text-blue-400 uppercase tracking-widest font-mono">Nome Completo</label>
                <input id="regNome" required type="text" class="input-tech w-full rounded-xl px-5 py-4 text-lg" placeholder="Nome Civil">
              </div>
              <div class="space-y-2">
                <label class="text-[10px] font-bold text-blue-400 uppercase tracking-widest font-mono">Data de Nascimento</label>
                <input id="regNasc" required type="date" class="input-tech w-full rounded-xl px-5 py-4 text-gray-300">
              </div>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
              <div class="space-y-2">
                <label class="text-[10px] font-bold text-gray-500 uppercase tracking-widest font-mono">CPF</label>
                <input id="regCPF" required type="text" class="input-tech w-full rounded-xl px-5 py-4" placeholder="000.000.000-00">
              </div>
              <div class="space-y-2 md:col-span-2">
                <label class="text-[10px] font-bold text-gray-500 uppercase tracking-widest font-mono">Rede Social (ID)</label>
                <div class="relative">
                  <span class="absolute left-5 top-4 text-gray-500"><i class="fab fa-tiktok"></i></span>
                  <input id="regTikTok" type="text" class="input-tech w-full rounded-xl pl-12 pr-5 py-4" placeholder="@usuario">
                </div>
              </div>
            </div>

            <div class="h-px bg-gradient-to-r from-transparent via-white/10 to-transparent my-4"></div>

            <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
              <div class="space-y-2">
                <label class="text-[10px] font-bold text-purple-400 uppercase tracking-widest font-mono">Espectro</label>
                <select id="regLado" required class="input-tech w-full rounded-xl px-5 py-4 cursor-pointer">
                  <option value="">Selecione...</option>
                  <option value="Direita">Direita</option>
                  <option value="Centro">Centro</option>
                  <option value="Esquerda">Esquerda</option>
                </select>
              </div>
              <div class="space-y-2 md:col-span-2">
                <label class="text-[10px] font-bold text-purple-400 uppercase tracking-widest font-mono">Partido Político</label>
                <select id="regPartido" required class="input-tech w-full rounded-xl px-5 py-4 text-gray-300 cursor-pointer">
                  <option value="">Selecione o espectro primeiro</option>
                </select>
              </div>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
              <div class="space-y-2">
                <label class="text-[10px] font-bold text-amber-500 uppercase tracking-widest font-mono">Número Eleitoral</label>
                <input id="regNumero" required type="number" class="input-tech w-full rounded-xl px-5 py-4 font-mono text-2xl text-amber-400 placeholder-gray-700 tracking-wider" placeholder="00">
              </div>
              <div class="space-y-2">
                <label class="text-[10px] font-bold text-gray-500 uppercase tracking-widest font-mono">Cargo</label>
                <select id="regCargo" required class="input-tech w-full rounded-xl px-5 py-4 cursor-pointer"></select>
              </div>
              <div class="space-y-2">
                <label class="text-[10px] font-bold text-gray-500 uppercase tracking-widest font-mono">Jurisdição</label>
                <select id="regTerritorio" required class="input-tech w-full rounded-xl px-5 py-4 cursor-pointer"></select>
              </div>
            </div>

            <div class="pt-8">
              <button type="submit" id="btnSubmit" class="btn-gold w-full py-5 rounded-xl text-lg shadow-xl flex justify-center items-center gap-3 active:scale-95 group">
                <span>PROTOCOLAR REGISTRO</span>
                <i class="fa fa-arrow-right group-hover:translate-x-1 transition-transform"></i>
              </button>
            </div>
          </form>
        </div>
      </section>

      <section id="admin" class="hidden animate-slide-up max-w-6xl mx-auto pb-20">
        
        <div id="adminLogin" class="card-glass rounded-2xl max-w-md mx-auto p-12 mt-12 text-center border border-red-500/20 relative overflow-hidden">
          <div class="absolute -top-20 -left-20 w-64 h-64 bg-red-600/10 blur-[80px] rounded-full"></div>
          
          <div class="w-20 h-20 bg-gradient-to-br from-red-500/10 to-red-900/10 rounded-2xl flex items-center justify-center mx-auto mb-8 text-red-500 text-3xl border border-red-500/30 shadow-[0_0_30px_rgba(239,68,68,0.1)]">
            <i class="fa fa-lock"></i>
          </div>
          
          <h2 class="text-3xl font-bold text-white mb-2">Acesso Magistrado</h2>
          <p class="text-gray-400 text-sm mb-10">Área restrita aos juízes dos TREs.</p>
          
          <div class="space-y-5 relative z-10">
            <select id="loginEstado" class="input-tech w-full rounded-xl px-5 py-4 cursor-pointer">
              <option value="">Selecione a Jurisdição...</option>
              <option value="Brookhaven">Brookhaven (TSE Central)</option>
              <option value="Novacore">Novacore</option>
              <option value="Casteríber">Casteríber</option>
              <option value="Fortemega">Fortemega</option>
              <option value="Florêmix">Florêmix</option>
            </select>
            <input id="loginSenha" type="password" placeholder="Chave de Segurança" class="input-tech w-full rounded-xl px-5 py-4">
            <button id="btnLogin" class="w-full bg-white text-black font-bold py-4 rounded-xl hover:bg-gray-200 transition tracking-wide text-sm uppercase">Autenticar</button>
          </div>
        </div>

        <div id="adminPanel" class="hidden space-y-8">
          <div class="card-glass p-8 flex flex-col md:flex-row justify-between items-center bg-gradient-to-r from-amber-900/10 to-transparent border-l-4 border-l-amber-500">
            <div class="flex items-center gap-6 mb-6 md:mb-0">
              <div class="w-16 h-16 rounded-2xl bg-gradient-to-br from-amber-400 to-orange-500 flex items-center justify-center text-black text-2xl font-bold shadow-lg shadow-orange-500/20">
                <i class="fa fa-gavel"></i>
              </div>
              <div>
                <div class="text-[10px] text-amber-500 font-bold uppercase tracking-[0.2em] mb-1">Juiz Eleitoral Logado</div>
                <div id="adminUserDisplay" class="text-3xl font-mono font-bold text-white tracking-tight">---</div>
              </div>
            </div>
            
            <div class="flex items-center gap-4">
              <div id="adminControls" class="hidden flex gap-3 mr-6 border-r border-white/10 pr-6">
                <button onclick="setElectionMode('Federal')" class="px-4 py-2 rounded-lg bg-blue-500/10 border border-blue-500/30 text-blue-400 text-xs font-bold hover:bg-blue-500 hover:text-white transition uppercase tracking-wider">Federal</button>
                <button onclick="setElectionMode('Municipal')" class="px-4 py-2 rounded-lg bg-green-500/10 border border-green-500/30 text-green-400 text-xs font-bold hover:bg-green-500 hover:text-black transition uppercase tracking-wider">Municipal</button>
              </div>
              <button onclick="logout()" class="text-red-400 hover:text-white text-xs font-bold uppercase tracking-widest flex items-center gap-2 px-6 py-3 rounded-lg bg-red-500/5 hover:bg-red-600 border border-red-500/20 transition">
                <i class="fa fa-power-off"></i> Sair
              </button>
            </div>
          </div>

          <div class="card-glass p-8 min-h-[500px]">
            <h3 class="font-bold text-xl text-white mb-8 flex items-center gap-3 pb-6 border-b border-white/5">
              <i class="fa fa-list-check text-blue-500"></i>
              Fila de Julgamento
            </h3>
            <div id="pendingList" class="space-y-4">
              </div>
          </div>
        </div>
      </section>

    </div>
  </main>

  <div id="toast-container" class="fixed top-6 right-6 flex flex-col gap-3 pointer-events-none z-50"></div>

  <script type="module">
    // --- FIREBASE CONFIG ---
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
    import { getDatabase, ref, push, update, onValue } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-database.js";

    const firebaseConfig = {
      apiKey: "AIzaSyAwFLV5X9ICB3mvU4WU1ihxGUeG9UsrbtQ",
      authDomain: "candidatura-cde.firebaseapp.com",
      databaseURL: "https://candidatura-cde-default-rtdb.firebaseio.com",
      projectId: "candidatura-cde",
      storageBucket: "candidatura-cde.firebasestorage.app",
      messagingSenderId: "958958180950",
      appId: "1:958958180950:web:51427276d0a83978fdb9f7"
    };

    // Inicialização segura
    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);

    // --- DADOS DO SISTEMA ---
    const TRE_PASSWORDS = {
      "Brookhaven": "Brookasil1234", 
      "Novacore": "williamNC",
      "Casteríber": "henriqueCB",
      "Fortemega": "lucasFM",
      "Florêmix": "popoFX"
    };

    const PARTIDOS = {
        Direita: ["PL (22)", "PP (11)", "Republicanos (10)", "PRTN (75)", "Patriota (51)", "PRTB (28)", "NOVO (30)", "PMB (35)", "DC (27)", "UDB (38)", "Agir (36)", "POL (81)", "ACN (84)", "PRONA (57)", "PDC (17)", "PESP (48)", "PMNL (86)"],
        Centro: ["MDB (15)", "UNIÃO (44)", "PSD (55)", "Podemos (20)", "PSDB (45)", "CDN (23)", "Solidariedade (77)", "Avante (70)", "PMN (33)", "PV (43)", "PUN (42)", "MPD (37)", "PDM (26)", "MTB (63)", "PTD (46)", "PDSD (88)", "MSS (14)", "PC (85)"],
        Esquerda: ["PT (13)", "PSOL (50)", "PCdoB (65)", "Rede (18)", "PDT (12)", "UP (80)", "PCO (29)", "PCB (21)", "PSTU (16)", "PPL (54)", "PSB (40)", "PFS (60)", "PS (56)", "PSTN (31)"]
    };

    const ESTADOS = {
      "Brookhaven": ["Cidade Eleitoral", "Liberty City"],
      "Novacore": ["Nexaville"],
      "Casteríber": ["Castelo Verde"],
      "Fortemega": ["Marinha City"],
      "Florêmix": ["Florápolis"]
    };

    let currentMode = "Federal"; 
    let currentUser = null; 
    let candidatesData = {};
    let chartIdeologiaInstance = null;
    let chartCargosInstance = null;

    // --- FUNÇÕES DE INTERFACE (UI) ---
    window.switchTab = (tabId, element) => {
      // Ocultar todas as seções
      ['dashboard', 'candidatos', 'registro', 'admin'].forEach(id => {
        const el = document.getElementById(id);
        el.classList.add('hidden');
        el.classList.remove('animate-slide-up');
      });
      
      // Mostrar seção alvo
      const target = document.getElementById(tabId);
      target.classList.remove('hidden');
      void target.offsetWidth; // Force reflow
      target.classList.add('animate-slide-up');

      // Atualizar Menu
      document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
      if(element) element.classList.add('active');

      const titles = {
        'dashboard': 'Visão Geral do Sistema',
        'candidatos': 'Candidaturas Deferidas',
        'registro': 'Protocolo de Intenção',
        'admin': 'Magistratura Eleitoral'
      };
      document.getElementById('pageTitle').innerText = titles[tabId] || 'Painel';
    };

    const showToast = (msg, type = 'info') => {
      const container = document.getElementById('toast-container');
      const toast = document.createElement('div');
      
      const styles = {
        success: 'border-green-500 bg-dark-800 text-white shadow-green-900/20',
        error: 'border-red-500 bg-dark-800 text-white shadow-red-900/20',
        info: 'border-blue-500 bg-dark-800 text-white shadow-blue-900/20'
      };
      
      const icons = { success: 'fa-check', error: 'fa-times', info: 'fa-info' };

      toast.className = `pointer-events-auto flex items-center gap-4 p-4 rounded-xl border-l-4 shadow-2xl backdrop-blur-md min-w-[350px] transform transition-all duration-300 translate-x-full opacity-0 ${styles[type]}`;
      toast.innerHTML = `
        <div class="w-8 h-8 rounded-full bg-white/10 flex items-center justify-center shrink-0"><i class="fa ${icons[type]}"></i></div>
        <div class="text-sm font-medium font-sans">${msg}</div>
      `;
      
      container.appendChild(toast);
      
      // Animação de entrada
      setTimeout(() => {
        toast.classList.remove('translate-x-full', 'opacity-0');
      }, 100);

      // Remover
      setTimeout(() => {
        toast.classList.add('translate-x-full', 'opacity-0');
        setTimeout(() => toast.remove(), 300);
      }, 4000);
    };

    // Relógio
    setInterval(() => {
      const now = new Date();
      document.getElementById('clock').innerText = now.toLocaleTimeString('pt-BR', {hour:'2-digit', minute:'2-digit'});
      const options = { weekday: 'long', day: 'numeric', month: 'long' };
      document.getElementById('serverDate').innerText = now.toLocaleDateString('pt-BR', options).toUpperCase();
    }, 1000);

    // --- LÓGICA DO SISTEMA ---
    
    // 1. Atualizar Selects do Formulário
    document.getElementById('regLado').addEventListener('change', (e) => {
      const select = document.getElementById('regPartido');
      select.innerHTML = '<option value="">Selecione...</option>';
      if (PARTIDOS[e.target.value]) {
        PARTIDOS[e.target.value].forEach(p => select.appendChild(new Option(p, p)));
      }
    });

    const updateFormOptions = () => {
      const cargoSel = document.getElementById('regCargo');
      const terrSel = document.getElementById('regTerritorio');
      cargoSel.innerHTML = '';
      terrSel.innerHTML = '';

      if (currentMode === 'Federal') {
        ['Presidente', 'Governador', 'Senador', 'Deputado Federal'].forEach(c => cargoSel.appendChild(new Option(c, c)));
        terrSel.appendChild(new Option('Brookasil (Nacional)', 'Brookasil'));
        Object.keys(ESTADOS).forEach(e => terrSel.appendChild(new Option(e, e)));
      } else {
        ['Prefeito', 'Vereador'].forEach(c => cargoSel.appendChild(new Option(c, c)));
        Object.entries(ESTADOS).forEach(([est, cids]) => {
          cids.forEach(cid => terrSel.appendChild(new Option(`${cid} - ${est}`, `${cid}|${est}`)));
        });
      }
    };

    // 2. Enviar Registro (Push to Firebase)
    document.getElementById('formCandidato').addEventListener('submit', async (e) => {
      e.preventDefault();
      const btn = document.getElementById('btnSubmit');
      const originalContent = btn.innerHTML;
      
      const num = document.getElementById('regNumero').value;
      const cargo = document.getElementById('regCargo').value;
      const territorioRaw = document.getElementById('regTerritorio').value;
      
      let estado = territorioRaw;
      let cidade = null;
      if(territorioRaw.includes('|')){
        [cidade, estado] = territorioRaw.split('|');
      }
      if(cargo === 'Presidente') estado = 'Brookasil';

      // Validação de Duplicidade (Client Side simples)
      const duplicado = Object.values(candidatesData).some(c => 
        c.numero === num && c.cargo === cargo && c.estado === estado && c.status !== 'rejeitado'
      );

      if(duplicado) {
        showToast('Este número já está em uso para este cargo/jurisdição.', 'error');
        return;
      }

      const novoCandidato = {
        nome: document.getElementById('regNome').value,
        nascimento: document.getElementById('regNasc').value,
        cpf: document.getElementById('regCPF').value,
        tiktok: document.getElementById('regTikTok').value,
        lado: document.getElementById('regLado').value,
        partido: document.getElementById('regPartido').value,
        numero: num,
        cargo: cargo,
        estado: estado,
        cidade: cidade,
        status: 'pendente',
        timestamp: Date.now()
      };

      try {
        btn.disabled = true;
        btn.innerHTML = '<span class="loader border-black"></span>';
        await push(ref(db, 'candidatos'), novoCandidato);
        showToast('Registro enviado com sucesso ao TRE.', 'success');
        document.getElementById('formCandidato').reset();
      } catch (err) {
        showToast('Erro de conexão com o banco de dados.', 'error');
        console.error(err);
      } finally {
        btn.disabled = false;
        btn.innerHTML = originalContent;
      }
    });

    // 3. Sistema Admin/Juiz
    document.getElementById('btnLogin').addEventListener('click', () => {
      const est = document.getElementById('loginEstado').value;
      const pass = document.getElementById('loginSenha').value;

      if(TRE_PASSWORDS[est] && TRE_PASSWORDS[est] === pass) {
        currentUser = est;
        document.getElementById('adminLogin').classList.add('hidden');
        document.getElementById('adminPanel').classList.remove('hidden');
        document.getElementById('adminUserDisplay').innerText = est.toUpperCase();
        
        if(est === 'Brookhaven') {
          document.getElementById('adminControls').classList.remove('hidden');
        } else {
          document.getElementById('adminControls').classList.add('hidden');
        }
        
        renderAdminList();
        showToast(`Sessão iniciada: TRE ${est}`, 'success');
      } else {
        showToast('Credenciais inválidas.', 'error');
      }
    });

    window.logout = () => {
      currentUser = null;
      document.getElementById('adminLogin').classList.remove('hidden');
      document.getElementById('adminPanel').classList.add('hidden');
      document.getElementById('loginSenha').value = '';
    };

    window.setElectionMode = async (mode) => {
      if(currentUser !== 'Brookhaven') return;
      await update(ref(db, 'config'), { mode: mode });
    };

    window.judgeCandidate = async (id, veredict) => {
      if(!currentUser) return;
      const status = veredict ? 'aprovado' : 'rejeitado';
      await update(ref(db, `candidatos/${id}`), { status: status, juiz: currentUser });
      showToast(veredict ? 'Candidatura Deferida.' : 'Candidatura Indeferida.', veredict ? 'success' : 'info');
    };

    const renderAdminList = () => {
      if(!currentUser) return;
      const list = document.getElementById('pendingList');
      list.innerHTML = '';
      
      const pendentes = Object.entries(candidatesData)
        .filter(([_, c]) => c.status === 'pendente')
        .filter(([_, c]) => {
          if(currentUser === 'Brookhaven') return true;
          return c.estado === currentUser || (c.cidade && c.estado === currentUser);
        });

      if(pendentes.length === 0) {
        list.innerHTML = `
          <div class="flex flex-col items-center justify-center py-20 opacity-30">
            <i class="fa fa-clipboard-check text-6xl mb-4"></i>
            <p class="font-mono text-lg">Nenhum processo aguardando julgamento.</p>
          </div>`;
        return;
      }

      pendentes.forEach(([key, c]) => {
        const item = document.createElement('div');
        item.className = 'card-glass p-6 flex flex-col md:flex-row justify-between items-center gap-6 border-l-4 border-l-amber-500 animate-slide-up';
        item.innerHTML = `
          <div class="w-full">
            <div class="flex items-center gap-3 mb-3">
              <span class="font-bold text-white text-xl">${c.nome}</span>
              <span class="bg-amber-500 text-black font-mono font-bold px-2 py-0.5 rounded text-sm">${c.numero}</span>
            </div>
            <div class="grid grid-cols-2 gap-x-12 gap-y-2 text-xs text-gray-400 font-mono uppercase tracking-wide">
              <p>Cargo: <span class="text-white">${c.cargo}</span></p>
              <p>Partido: <span class="text-white">${c.partido}</span></p>
              <p>Local: <span class="text-white">${c.cidade ? c.cidade + ' / ' : ''}${c.estado}</span></p>
              <p>CPF: <span class="text-white">${c.cpf}</span></p>
            </div>
          </div>
          <div class="flex gap-3 w-full md:w-auto min-w-[200px]">
            <button onclick="judgeCandidate('${key}', true)" class="flex-1 bg-green-500/10 hover:bg-green-500 hover:text-black text-green-500 border border-green-500/30 px-4 py-3 rounded-lg transition font-bold text-xs uppercase tracking-widest">
              Deferir
            </button>
            <button onclick="judgeCandidate('${key}', false)" class="flex-1 bg-red-500/10 hover:bg-red-500 hover:text-white text-red-500 border border-red-500/30 px-4 py-3 rounded-lg transition font-bold text-xs uppercase tracking-widest">
              Indeferir
            </button>
          </div>
        `;
        list.appendChild(item);
      });
    };

    // --- ESCUTA EM TEMPO REAL (REALTIME DATABASE) ---

    // 1. Config Mode
    onValue(ref(db, 'config'), (snap) => {
      const data = snap.val();
      currentMode = (data && data.mode) ? data.mode : 'Federal';
      document.getElementById('displayMode').innerText = currentMode.toUpperCase();
      updateFormOptions();
    });

    // 2. Dados dos Candidatos
    onValue(ref(db, 'candidatos'), (snap) => {
      candidatesData = snap.val() || {};
      const arr = Object.values(candidatesData);
      
      // Update KPIs
      document.getElementById('statTotal').innerText = arr.length;
      document.getElementById('statPending').innerText = arr.filter(c => c.status === 'pendente').length;
      document.getElementById('statApproved').innerText = arr.filter(c => c.status === 'aprovado').length;

      // Se admin estiver aberto, atualiza lista
      renderAdminList();

      // Renderiza Grid Pública
      const publicGrid = document.getElementById('publicGrid');
      const filterLado = document.getElementById('filterPublicLado').value;
      publicGrid.innerHTML = '';
      
      const aprovados = arr.filter(c => c.status === 'aprovado' && (filterLado === '' || c.lado === filterLado));
      
      aprovados.forEach(c => {
        // Cores baseadas na ideologia
        const color = c.lado === 'Esquerda' ? 'red' : c.lado === 'Direita' ? 'blue' : 'yellow';
        const colorHex = c.lado === 'Esquerda' ? '#EF4444' : c.lado === 'Direita' ? '#3B82F6' : '#EAB308';
        
        const card = document.createElement('div');
        card.className = `card-glass p-0 overflow-hidden group hover:scale-[1.02] transition duration-300 flex flex-col`;
        card.innerHTML = `
          <div class="h-1.5 w-full shadow-[0_0_15px_${colorHex}]" style="background: ${colorHex}"></div>
          <div class="p-6 relative flex-1 flex flex-col">
            <div class="flex justify-between items-start mb-4">
               <div class="text-[10px] font-bold text-gray-500 border border-white/10 px-2 py-1 rounded uppercase tracking-wider bg-white/5">
                ${c.partido.split(' ')[0]}
              </div>
              ${c.tiktok ? `
                <a href="https://tiktok.com/@${c.tiktok.replace('@','')}" target="_blank" class="text-gray-500 hover:text-white transition transform hover:scale-110">
                  <i class="fab fa-tiktok text-lg"></i>
                </a>` : ''}
            </div>
            
            <div class="mb-6 flex-1">
              <h3 class="font-bold text-white text-2xl leading-tight font-sans">${c.nome}</h3>
              <p class="text-xs text-gray-400 mt-1 uppercase tracking-wide font-mono">${c.cargo}</p>
            </div>
            
            <div class="flex items-end justify-between mt-auto">
              <div class="text-4xl font-mono font-bold text-white tracking-tighter drop-shadow-[0_0_10px_${colorHex}88]">
                ${c.numero}
              </div>
              <div class="text-[9px] text-gray-600 uppercase tracking-widest flex items-center gap-1 font-bold">
                <i class="fa fa-map-pin"></i> ${c.estado}
              </div>
            </div>
          </div>
        `;
        publicGrid.appendChild(card);
      });

      updateCharts(arr);
    });

    // Filtro Dropdown
    document.getElementById('filterPublicLado').addEventListener('change', () => {
        // Trigger manual refresh simulating data update
        const dummyEvent = new Event('value');
        // Na prática, basta chamar a lógica de renderização novamente, 
        // mas aqui vamos apenas recarregar visualmente via refresh simples pois o onValue já cuida dos dados
        location.reload(); 
    });

    function updateCharts(data) {
        const aprovados = data.filter(c => c.status === 'aprovado');
        
        // Chart Config
        Chart.defaults.color = '#64748b';
        Chart.defaults.font.family = 'Space Grotesk';
        Chart.defaults.borderColor = 'rgba(255,255,255,0.05)';
        
        // --- Grafico Ideologia (Doughnut) ---
        const counts = { Direita: 0, Centro: 0, Esquerda: 0 };
        aprovados.forEach(c => { if(counts[c.lado] !== undefined) counts[c.lado]++ });

        const ctx1 = document.getElementById('chartIdeologia');
        if(chartIdeologiaInstance) chartIdeologiaInstance.destroy();
        
        chartIdeologiaInstance = new Chart(ctx1, {
            type: 'doughnut',
            data: {
                labels: ['Esquerda', 'Centro', 'Direita'],
                datasets: [{
                    data: [counts.Esquerda, counts.Centro, counts.Direita],
                    backgroundColor: ['#EF4444', '#EAB308', '#3B82F6'],
                    borderWidth: 0,
                    hoverOffset: 10
                }]
            },
            options: { 
              responsive: true,
              maintainAspectRatio: false,
              cutout: '80%',
              plugins: { legend: { position: 'right', labels: { usePointStyle: true, boxWidth: 8, font: { size: 10 } } } } 
            }
        });
        
        // --- Grafico Cargos (Bar) ---
        const cargosCount = {};
        aprovados.forEach(c => { cargosCount[c.cargo] = (cargosCount[c.cargo] || 0) + 1 });
        const sortedCargos = Object.entries(cargosCount).sort((a,b) => b[1] - a[1]).slice(0, 5);
        
        const ctx2 = document.getElementById('chartCargos');
        if(chartCargosInstance) chartCargosInstance.destroy();
        
        // Gradient Bar
        const grad = ctx2.getContext('2d').createLinearGradient(0,0,0,300);
        grad.addColorStop(0, '#3B82F6');
        grad.addColorStop(1, '#1e1b4b');

        chartCargosInstance = new Chart(ctx2, {
            type: 'bar',
            data: {
                labels: sortedCargos.map(x => x[0]),
                datasets: [{
                    label: 'Candidatos',
                    data: sortedCargos.map(x => x[1]),
                    backgroundColor: grad,
                    borderRadius: 4,
                    barThickness: 40
                }]
            },
            options: { 
                responsive: true,
                maintainAspectRatio: false,
                scales: { 
                    y: { beginAtZero: true }, 
                    x: { grid: { display: false } } 
                },
                plugins: { legend: { display: false } }
            }
        });
    }
  </script>
</body>
</html>
